<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BugTracker Tests</title>
    <link rel="stylesheet" href="styles/test.css" />

    <!-- Angular2 stuff -->
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="../node_modules/systemjs/dist/system.src.js"></script>
    <script src="../node_modules/angular2/bundles/angular2-polyfills.js"></script>
    <script src="../node_modules/rxjs/bundles/Rx.js"></script>
    <script src="../node_modules/angular2/bundles/angular2.dev.js"></script>
    <script src="../node_modules/angular2/bundles/router.dev.js"></script>
    <script src="../node_modules/angular2/bundles/http.dev.js"></script>
    <script src="app/systemConfig.js"></script>
    <script src="app/systemConfig.test.js"></script>
    <script type="text/javascript">
        function getTestResultRepresentation(testResult){
            var template = '<div>';
            
            if (testResult.successful){
                template += '<p class="success"><strong>&#10004;</strong> ';
            }
            else{
                template += '<p class="error"><strong>&#10006;</strong> ';
            }
            template += testResult.testFixture+' - '+testResult.testMethod;
            if (!testResult.successful){
                template += '<br>'+testResult.errorMessage;
            }
            template += '</p></div>';
            return $(template);
        }
        function renderTestResults(testModule){
            var testRunner = new testModule.TestRunner();
            var testResults = testRunner.execute();
            
            document.body.innerText = '';
            var $body = $(document.body);
            
            var $root = $('<div class="testResults">');
            
            var totalTestCount = testResults.success.length + testResults.failed.length;
            $root.append('<h1 class="header">Result: <strong>'+testResults.success.length+' / '+totalTestCount+'</strong> Tests passed.</h1>');
            
            if (testResults.failed.length > 0){
                $root.append('<sub class="errorInfo">Check the console output for more information</sub>');
            }
            
            testResults.failed.forEach(function(testResult){
                var $item = getTestResultRepresentation(testResult);
                $root.append($item);
                console.error(testResult.errorMessage);
            });
            testResults.success.forEach(function(testResult){
                var $item = getTestResultRepresentation(testResult);
                $root.append($item);
            });
            $body.append($root);
        }
    
		System.import("deep-freeze").then(function(deepFreeze){
            System.import("app/tests")
                .then(renderTestResults)
                .catch(function(error) { 
                    document.body.innerText = `Error(s) occurred:\n\n${error.message}\n\nPlease check the console for further details.`;
                    document.body.classList.add('error');
                    console.error(error);
                })
        }).catch(console.log.bind(console));
    </script>
</head>
<body>
    loading...
</body>
</html>